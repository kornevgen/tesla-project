\section{Алгоритм распределения элементов тестового шаблона по
сетам}\label{sets}

Алгоритм должен распределить команды обращения в память данного
тестового шаблона по сетам, т.е. указать, какие команды обращаются в
один сет, а какие -- в разные. Командой обращения в память считается
такая команда, в описании тестовой ситуации которой присутствует
вызов функций LoadMemory или StoreMemory (при этом обязательно будет
вызов функции AddressTranslation, осуществляющей трансляцию
виртуального адреса в физический). Для распределения сетов следует
на основе тестовых ситуаций в TLB (т.е. указаний в тестовом шаблоне
на то, как исполняется AddressTranslation) составить задачу
разрешения ограничений над целыми числами, описывающих некоторые
аспекты трансляции адресов, и на основе результата ее решения
построить соотношения на сеты (физических адресов).

Алгоритм состоит из трех шагов. На первом шаге строятся ограничения
на целые числа и конечные множества чисел, описывающие трансляцию
адресов, на втором шаге полученные ограничения разрешаются и на
третьем шаге строятся соотношения на сеты. Для выполнения второго
шага достаточно применение известных алгоритмов разрешения
ограничений~\cite{ConstrProp} и методов решения систем на конечные
множества. Первый же шаг требует пояснений. На первом этапе этого
шага выделяются ограничения по очередной тестовой ситуации, а на
втором этапе выделяются ограничения, для формулирования которых
нужно использовать весь тестовый шаблон (например, для формулировки
политики замещения может потребоваться весь тестовый шаблон). TLB
содержит структуру номеров виртуальных и физических страниц, а также
кэш-память номеров виртуальных страниц~\cite{mips64_III}. Поэтому
тестовые ситуации в TLB составляют тестовые ситуации на кэш-память
TLB и тестовые ситуации на структуру страниц TLB (точнее, на
активную в данной команде строку этой структуры). Трансляция первых
тестовых ситуаций делается аналогично тому, как это делалось в
п.~\ref{eqs}. Тестовые ситуации на строку TLB есть ограничения на
целые числа, которые транслируются непосредственно.

Результатом разрешения ограничений будут соотношения типа
<<равенство -- неравенство>> номера виртуальной страницы команд
обращения в память. Каждой такой команде по номеру виртуальной
страницы (строке TLB) определяется сет физического адреса согласно
алгоритму трансляции адресов~\cite{mips64_III}. Верно утверждение,
что при равенстве номеров виртуальных страниц для двух разных команд
будут совпадать и сеты физических адресов, с которыми работают эти
команды. Дополнительные соотношения на сеты можно выделить,
анализируя значения выражений для виртуальных адресов - если такие
выражения совпадают, то совпадают и физические адреса, а, значит, и
их сеты.
