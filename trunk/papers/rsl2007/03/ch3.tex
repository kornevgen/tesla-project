\chapter{Множества}

\section{Определения и операции}
Множество -- это контейнер элементов одного типа, который обладает
свойствами уникальности и неупорядоченности элементов.

Типовое выражение для конечного множества: $typeexpr\Set$. Типовое
выражение для бесконечного множества: $typeexpr\Infset$. Конечное
множество -- подтип бесконечного множества.

Операции:
\begin{list}{}{}
\item $= : T\Infset \DP T\Infset \Fn \Bool$ -- сравнение на равенство
\item $\neq : T\Infset \DP T\Infset \Fn \Bool$ -- сравнение на не равенство
\item $\Union: T\Infset \DP T\Infset \Fn T\Infset$ -- объединение множеств
\item $\Inter: T\Infset \DP T\Infset \Fn T\Infset$ -- пересечение множеств
\item $\Minus: T\Infset \DP T\Infset \Fn T\Infset$ -- вычитание множеств
\item $\Isin: T \DP T\Infset \Fn \Bool$ -- проверка на принадлежность
\item $\NotIsin: T \DP T\Infset \Fn \Bool$ -- проверка на непринадлежность
\item $\SetL: T\Infset \DP T\Infset \Fn \Bool$ -- проверка вложения
\item $\SetG: T\Infset \DP T\Infset \Fn \Bool$ -- проверка вложения
\item $\SetLE: T\Infset \DP T\Infset \Fn \Bool$ -- проверка вложения
\item $\SetGE: T\Infset \DP T\Infset \Fn \Bool$ -- проверка вложения
\item $\Card: T\Infset \NonDetermFn \Nat$ -- количество элементов
($\Chaos$ для бесконечных множеств)
\end{list}


Конструктор множества:
\begin{list}{}{}
\item (\emph{пустое множество}) \{\}
\item (\emph{перечисление}) \{0, 1, 2\} - множество, состоящее из трех целых чисел (не
натуральных!) - нуля, единицы и двойки.
\item (\emph{диапазон}) \{0..2\} -  то же, что и \{0, 1, 2\};
\{0..0\} $\Iden$ \{0\}, \{1..0\} $\Iden$ \{\}
\item (\emph{<<сокращенная запись>>}) $\{ expr\_with\_var | var : typeexpr
\SuchAs boolexpr\}$ (например, $\{2 \star n | n : \Nat \SuchAs n < 3
\}$, что эквивалентно \{0, 2, 4\})
\end{list}


\section{Задачи}

В занятие входят все задачи из методического пособия
(\cite{metodichka}) + приведённые ниже. Не решенные на занятии
задачи идут в домашнюю работу.

\subsection{Вычислить}
\begin{enumerate}
\item $\{1, 2\} = \{3, 1\}$
\item $\{1, 2\} = \{2, 1\}$
\item $\{1, 2, 1\} = \{2, 2, 1\}$
\item $\{1, 2\} \Union \{3, 4\}$
\item $\{1, 2\} \Union \{2, 3\}$
\item $\{1, 2\} \Inter \{3, 4\}$
\item $\{1, 2\} \Inter \{2, 3\}$
\item $\{1..30\} \Union \{10..-10\}$
\item $\{1..30\} \Inter \{10..-10\}$
\item $\{1..30\} \Union \{x| x: \Int \SuchAs \Abs x < 11 \}$
\item $\{1..30\} \Inter \{x| x: \Int \SuchAs \Abs x < 11 \}$
\item $\{x+10 | x: \Int \} = \{x | x: \Int\}$
\item $\{5*k + 2 | k : \Int \} \Inter \{3*k - 1 | k : \Int\}$
\item $\{5*k + 2 | k : \Int \} \Minus \{3*k - 1 | k : \Int\}$
\item $\{5*k + 2 | k : \Int \} \SetL \{3*k - 1 | k : \Int\}$
\item $\{5*k + 2 | k : \Int \} \SetGE \{3*k - 1 | k : \Int\}$
\item $\Not (\{1, 2\} \SetLE \{2, 1, 1\})$
\item $\Card \{1..30\}$
\item $\Card \{5*k + 2 | k : \Int \SuchAs k * k \Isin \{-10..10\}\}$
\item $\Card \{5*k + 2 | k : \Int \SuchAs k * k \Isin \{10..-10\}\}$
\item $\Card \{k*k - 2 * k | k : \Int \SuchAs k * k \Isin \{-10..10\}\}$
\item $\All x: \Nat \SuchAs x \Isin \{x | x : \Int\}$
\item $\All x: \Int \SuchAs x \Isin \{x | x : \Nat\}$
\end{enumerate}

\subsection{Решите уравнения}
\begin{enumerate}
\item $\{1\} \Union x = \{\}$
\item $\{1\} \Union x = \{1\}$
\item $\{1\} \Union x = \{1, 2\}$
\item $\{1\} \Inter x = \{\}$
\item $\{1\} \Inter x = \{1\}$
\item $\{1\} \Inter x = \{1, 2\}$
\item $\{2, 1\} \Minus x = \{1\}$
\item $\Card x = 0$
\item $\Card x = 1$
\end{enumerate}

\subsection{Какие их следующих выражений верны}
Считайте, что свободные переменные располагаются под квантором
всеобщности
\begin{enumerate}
\item $(A \cup B) \setminus C = (A \setminus C) \cup (B \setminus C)$
\item $(A \setminus B) \cap C = (A \cap C) \setminus B$
\item $(A \cup B) \setminus C \Iden (A \setminus C) \cup (B \setminus C)$
\item $A \cup \{\} = A$
\item $\{\} \cup A = A$
\item $(A \cup B) \cap C = (A \cap C) \cup (B \cap C)$
\item $\Card \Nat < \Card \Int$
\item $\Card \Nat = \Card \Int$
\item $\Card \Nat > \Card \Int$
\item $\Card \Nat \Iden \Card \Int$
\item $\Card \{n ~|~ n:\Nat\} \Iden \Card \{n ~|~ n:\Int\}$
\end{enumerate}

\subsection{Записать на RSL следующие константы и определения
типов}\label{const}
\begin{enumerate}
\item Пустое множество
\item Множество чисел 1, 2, 3 (а также множество чисел от 1 до 3)
\item Множество всех чётных чисел
\item Множество всех чётных чисел, не превышающих 10 (привести в
виде перечисления и нескольких различных сокращённых формах)
\item\label{prset} Множество всех простых натуральных чисел
\item Множество всех пар взаимнопростых натуральных чисел
\item Множество всех троек, в каждой из которых есть одинаковые
элементы
\item Множество всех степеней двойки, не превышающих 100 (привести в
виде перечисления и нескольких сокращённых формах)
\item Множество всех IP-адресов класса А (B, C, D, E)
\item Множество всех точек плоскости, образующих
    \begin{enumerate}
    \item Прямую -- биссектрису I и III квадрантов
    \item Правую полуплоскость
    \item Нижнюю полуплоскость
    \item Единичную окружность
    \item Единичный круг
    \item Единичный квадрат со сторонами, параллельными осям
    координат
    \end{enumerate}
\end{enumerate}

\subsection{Записать на RSL следующие определения типов с учетом ограничений
типа}\label{RSLtype}
\begin{enumerate}
\item Расписание на сегодня. Содержит указание, в какой аудитории на
каждой паре учится группа. Учесть, что расписание должно быть
корректным, т.е. не должно быть аудитории, в которой бы занимались
две разные группы.
\item Граф. Опишите константу этого типа.
\item На основе типа <<Граф>> описать следующие его подтипы:
    \begin{enumerate}
    \item ориентированный
    \item неориентированный
    \item полный
    \item линейный (т.е. связный, представляющий собой цепочку вершин)
    \item двудольный
    \item связный
    \item${^\star}$ плоский
    \end{enumerate}
\item\label{arr} Массив (представить в виде множества пар
<<Индекс-Значение>>).  Опишите константу этого типа.
\item Конечный автомат \\ \textit{Примечание: } Конечный автомат состоит из
    \begin{enumerate}
    \item множества входных символов
    \item множества выходных символов
    \item множества состояний
    \item начального состояния
    \item таблицы переходов автомата (старое состояние $\times$ символ
    $\rightarrow$ новое состояние $\times$ символ)
    \end{enumerate}
\item\label{fsm} Машина Тьюринга \\ \textit{Примечание: } Машина Тьюринга состоит из
    \begin{enumerate}
    \item множества символов
    \item множества состояний
    \item пустого символа
    \item начального состояния
    \item множества финальных состояний
    \item лента
    \item таблицы автомата (старое состояние $\times$ символ
    $\rightarrow$ новое состояние $\times$ символ $\times$ сдвиг
    головки автомата)
    \end{enumerate}
    Запишите в типе ограничение о том, что перед началом работы слово на
    ленте должно иметь конечную длину (конечное число символов,
    отличных от пустого).
\item Измеримое множество на прямой \\ \textit{Примечание: } Множество $E$
измеримо, если $\forall \varepsilon > 0 ~\exists G \supseteq E : | G
\setminus E|^{\star} < \varepsilon$. Внешняя мера $|E|^{\star} =
\inf \sigma(S(E))$. $\sigma(\bigcup [a_i, b_i]) = \sum |b_i - a_i|$.
$S(E)$ -- множество интервалов, покрывающих $E$.
\end{enumerate}

\subsection{Построить явную (неявную) спецификации на RSL для
следующих программ} В этих задачах, если удаётся, следует привести
два варианта решения: с использованием сокращённой записи множества
и с помощью рекурсии.
\begin{enumerate}
\item Дано множество чисел. Вернуть множество квадратов чисел
данного множества.
\item Дано множество чисел. Вернуть множество чисел, представимых
суммами каких-либо двух элементов исходного множества.
\item Дано множество точек, заданных координатами в плоской декартовой системе
координат. Получить проекцию этого множества на ось \textsc{Ox}.
\item Дано множество простых чисел (см. задачу~\ref{const}.\ref{prset}). Для данного числа вернуть
множество его простых делителей.
\item Дано множество чисел. Дано число. Существует ли подмножество
данного множества чисел, сумма элементов которого, равна данному
числу?
\item Дано множество множеств. Вернуть множество всех элементов внутренних множеств.
\item \textit{(Задача о рюкзаке)} Дано множество предметов. Каждый
предмет имеет массу. Есть $n$ рюкзаков. Каждый рюкзак имеет
вместимость $K$ кг. Распределить все предметы по рюкзакам, не
превышая вместимости каждого рюкзака.
\item Рабочая группа компьютеров задаётся IP-адресом (4 целых числа, каждое от 0 до 255) и маской
(целое число от 0 до 32). Программа по данному заданию строит
множество всех возможных в ней IP-адресов.
\item Для типа <<Массив>>, определённого в задаче~\ref{RSLtype}.\ref{arr},
написать спецификации следующих операций (все изменяемые параметры
должны быть включены в возвращаемое значение):
    \begin{enumerate}
    \item Вычисление длины массива
    \item Получение значения по индексу $i$ (если по этому индексу
    значения нет, возвратить \Chaos)
    \item Изменение значения по индексу $i$ на значение $v$
    (обратите внимание, что операция частично вычислима!)
    \item Для массива из чисел: получение номера максимального элемента
    \end{enumerate}
\item${^\star}$ Для типа <<Машина Тьюринга>>, определённого в
задаче~\ref{RSLtype}.\ref{fsm}, написать спецификацию следующих
функций:
    \begin{enumerate}
    \item \textit{(загрузка слова)} по данному слову, представляющему список символов,
    возвращает ленту, на которой это слово расположено
    \item \textit{(шаг машины)} по данному состоянию машины
    возвратить следующее состояние
    \item \textit{(терминирование)} проверка, является ли
    состояние машины финальным
    \item \textit{(применимость)} проверка, применимо ли данное
    слово (список символов) на данной Машине Тьюринга (если не
    применимо, возвратить \Chaos)
    \end{enumerate}
\end{enumerate}

\subsection{База данных <<Журналы-Подписчики>>} Для приведённого
ниже неформального описания поведения функций и ограничений для базы
данных <<Журналы-Подписчики>> составить сигнатуры и явные
спецификации на RSL

\begin{verbatim}
type Magazin, Subscriber,
    Mailbox = Subscriber >< Magazin-set,
    PubHouse = Magazin-set >< Mailbox-set
value
    /* 1. выдать все журналы, печатаемые данным издательством */

    /* 2. печатает ли данное издательство данный журнал */

    /* 3. любой подписчик данного издательства выписывает
        не менее 1 и не более 5 журналов в данном издательстве */

    /* 4. любой журнал данного издательства выписывается не
            менее 1м и не более 100 людьми */

    /* 5. выдать подписчиков данного журнала
            в данном издательстве */

    /* 6. выдать множество журналов, выписываемое данным
        человеком в данном издательстве */

    /* 7. добавить журнал в данное издательство */

    /* 8. убрать журнал из данного издательства */
\end{verbatim}


\subsection{Написать спецификацию согласно приведённому
требованию}
\begin{enumerate}
\item Библиотека оперирует с книгами и читателями. Написать
спецификацию базы данных <<Картотека>>, состоящая из карточек. На
каждой карточке написано имя читателя и книги, которые он в данный
момент читает. При описании учтите, что для одного читателя не может
быть двух карточек с его именем.
\item Новый оперный театр заказал Вам спецификацию базы данных своего
репертуара и труппы. Заказчик так описал Вам свой театр: есть
артисты, есть оперы. Постановка задаётся указанием оперы и
задействованных в ней артистов. Театр можно описать, указав труппу
(артистов) и репертуар (все постановки). К базе должны быть
определены следующие операции:
    \begin{enumerate}
    \item выдать всех артистов, работающих в театре
    \item выдать всех артистов, участвующих в постановках
    \item выдать все постановки, в которых задействованы не менее 20
    артистов
    \item выдать все постановки, в которых участвует данный артист
    \item выдать всех артистов, задействованных в данной постановке
    \item добавить нового артиста в театр
    \item удалить артиста из театра
    \end{enumerate}
\end{enumerate}

%\subsubsection{Построить явную спецификацию по неявной}


\subsection{Предложить уточнение поведения}
Дана аксиоматическая спецификация. Предложить уточнение для неё в
виде неявной или явной спецификаций.

\begin{enumerate}
\item
    \begin{verbatim}
type S, E
value
    f : S >< E -> Bool,
    g : S >< S -> Bool,
    h : S >< E -~-> Nat
axiom
    [A]
    all s1, s2: S :-
    (
        (all e: E :- ( f(s1, e) => f(s2, e) )
            => g(s1, s2))
    ),

    [B]
    all s: S, e: E :- ( h(s, e) is chaos ) is ~f(s, e),

    [C]
    all s: S :- ~(exists e1, e2: E :- f(s, e1) /\ f(s, e2)
            /\ h(s, e1) = h(s, e2) /\ e1 ~= e2),

    [D]
    all s: S :- ~(exists s2: S :-
        (exists e: E :- f(s, e) /\ f(s2, e)
            /\ h(s, e) ~= h(s2, e))
        => s ~= s2)
    \end{verbatim}
\item та же спецификация, но без аксиомы C
\item та же спецификация, но без аксиомы D
\item
    \begin{verbatim}
type S, E
value
    f: S >< E -> Bool,
    u: S >< S -> S,
    i: S >< S -> S,
axiom
    all s1, s2: S, e: E :-
        f(u(s1, s2), e) is f(s1, e) \/ f(s2, e),
    all s1, s2: S, e: E :-
        f(i(s1, s2), e) is f(s1, e) /\ f(s2, e)
    \end{verbatim}
\item
    \begin{verbatim}
type S, E
value
    C: S,
    c: S -~-> Int,
    f: S >< E -> Bool,
    g: S >< E -~-> S
axiom
    all e: E :- ~f(C, e),
    all s: S, e: E :-
    f(s, e) =>
    (
        let s1 = g(s, e) in
        (
            ~f(s1, e) /\
            (all e1: E :- e1 ~= e /\ f(s, e1) => f(s1, e1))
        )
        end
    ),
    c(C) is 0,
    all s: S, e: E :- c(s) is c(g(s, e)) + 1
    \end{verbatim}
\item
    \begin{verbatim}
type S, E
value
    f: S >< E -> Bool,
    u: S >< S -> S,
    i: S >< S -> S
axiom
    all s1, s2: S, e: E :-
        f(u(s1, s2), e) is f(s1, e) /\ ~f(s2, e),
    all s1, s2: S, e: E :-
        f(i(s1, s2), e) is f(s1, e) ~= f(s2, e)
    \end{verbatim}
\end{enumerate}

%\subsubsection{Доказательство корректности уточнения}
%
%Доказать, что схема S2 является уточнением схемы S1


\subsection{Разное}
\begin{enumerate}
\item Студент Иванов написал такое определение на RSL того факта,
что [0, 1] -- измеримое на прямой множество (extmes : ((\Real ><
\Real)\Infset $\rightarrow$ \Real)):
\begin{verbatim}
all `epsilon:Real :- `epsilon > 0 =>
  exists G: (Real >< Real)-infset :- G > E =>
    extmes( G / E ) < epsilon
\end{verbatim}
Помогите Иванову получить зачёт по МФСП, т.е. сделать так, чтобы
\textsc{RSL Type Checker} на его спецификации не выдавал сообщений
об ошибках.
\end{enumerate}
