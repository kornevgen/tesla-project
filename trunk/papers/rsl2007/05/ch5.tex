\chapter{Отображения}

\section{Определения и операции}

Отображение -- это множество пар элементов, у которого первые
компоненты не повторяются.

Типовое выражение для детерминированного отображения: $typeexpr_1
\Map typeexpr_2$. Типовое выражение для недетерминированного
отображения: $typeexpr_1 \NonDeterMap typeexpr_2$.

Операции:
\begin{list}{}{}
\item $=: (T_1 \Map T_2) \DP (T_1 \Map T_2) \Fn \Bool$ -- сравнение отображений на равенство
\item $\neq: (T_1 \Map T_2) \DP (T_1 \Map T_2) \Fn \Bool$ -- сравнение отображений на не равенство
\item $(.): (T_1 \Map T_2) \DP T_1 \NonDetermFn T_2$ -- взятие
значения по индексу ($\Chaos$, если значение по этому индексу не
определено)
\item $\Dom: (T_1 \Map T_2) \Fn T_1\Infset$ -- \emph{область определения} отображения
\item $\Rng: (T_1 \Map T_2) \Fn T_2\Infset$ -- \emph{область значения} отображения
\item $\Upd: (T_1 \Map T_2) \DP (T_1 \Map T_2) \Fn (T_1 \Map T_2)$ -- обновление отображения
\item $\Union: (T_1 \Map T_2) \DP (T_1 \Map T_2) \Fn (T_1 \NonDeterMap T_2)$ -- объединение отображений
\item $\Minus: (T_1 \Map T_2) \DP T_1\Infset \Fn (T_1 \Map T_2)$ -- уменьшение отображения
\item $/: (T_1 \Map T_2) \DP T_1\Infset \Fn (T_1 \Map T_2)$ -- проекция отображения
\item $\Superp: (T_2 \Map T_3) \DP (T_1 \Map T_2) \Fn (T_1 \Map T_2)$ -- композиция отображений
\end{list}

Конструктор отображения:
\begin{list}{}{}
\item (\emph{пустое отображение}) []
\item (\emph{перечисление}) $[0 \mapsto 1, 1 \mapsto 2]$ -- отображение,
состоящий из двух пар целых чисел (не натуральных!) - из 0 в 1 и из
1 в 2.
\item (\emph{<<сокращенная запись>>}) $[expr_1\_with\_var \mapsto expr_2\_with\_var | var : typeexpr
\SuchAs boolexpr]$ (например, $[n \mapsto n+1 | n : \Nat \SuchAs n <
3]$, что эквивалентно $[0 \mapsto 1, 1 \mapsto 2, 2 \mapsto 3]$)
\end{list}


\newcommand{\Masha}{\mbox{\textrm{"Маша"}}}
\newcommand{\Sveta}{\mbox{\textrm{"Света"}}}
\newcommand{\Misha}{\mbox{\textrm{"Миша"}}}
\newcommand{\Slava}{\mbox{\textrm{"Слава"}}}
\newcommand{\Anna}{\mbox{\textrm{"Аня"}}}
\newcommand{\Petr}{\mbox{\textrm{"Петя"}}}
\newcommand{\Lesha}{\mbox{\textrm{"Леша"}}}
\newcommand{\Victor}{\mbox{\textrm{"Витя"}}}

\section{Задачи}

\subsection{Вычислить}
\begin{enumerate}
\item $\map{n \mapsto 1}{n : \Nat \SuchAs n \Isin \{1..3\} }$
\item $\map{n \mapsto n}{n : \Nat \SuchAs n \Isin \{5..5\} }$
\item $\map{n \mapsto n+1}{n : \Nat \SuchAs n \Isin \{100..90\} }$
\item $\map{n \mapsto m}{n, m : \Nat \SuchAs n \backslash m = 0 \And m >
2}$
\item $\map{n \mapsto m}{n, m : \Nat \SuchAs n \Isin \{1..3\} \And m \Isin
\{1..n\}}$
\item $\map{n \mapsto (p, q)}{n, p, q : \Nat \SuchAs n \Isin \{1..100\} \And p + q = n \And p \backslash q =
0}$
\item $[1 \mapsto 2,~2 \mapsto 3,~ 3 \mapsto 1] (3)$
\item $[1 \mapsto 2,~2 \mapsto 3,~ 3 \mapsto 1] (4)$
\item $[ \Masha \mapsto 30, \Sveta \mapsto 15, \Masha \mapsto 30]
(\Masha)$
\item $[ \Masha \mapsto 30,  \Sveta \mapsto 15, \Masha \mapsto 10
] (\Masha)$
\item $[1 \mapsto [1 \mapsto 1,~ 2 \mapsto 2,~ 3 \mapsto 3], 2 \mapsto [1 \mapsto 4,~ 2 \mapsto 5,~ 3 \mapsto 6]~]~ (2)~(1)$
\item $\Dom [3 \mapsto 1, 5 \mapsto 0, 2 \mapsto 88]$
\item $\Rng [3 \mapsto 1, 5 \mapsto 0, 2 \mapsto 88]$
\item $\Dom \map{n \mapsto 2 * n}{n : \Nat}$
\item $\Rng \map{n \mapsto 2 * n}{n : \Nat}$
\item $[1 \mapsto 20, 2 \mapsto 30] \Union [1 \mapsto 30, 2
\mapsto 20]$
\item $[1 \mapsto 20, 2 \mapsto 30] \Upd [1 \mapsto 30, 2
\mapsto 20]$
\item $[ \Misha \mapsto 170, \Slava \mapsto 200, \Victor \mapsto
195 ] ~\backslash  \{\Misha, \Petr\}$
\item $[ \Misha \mapsto 170, \Slava \mapsto 200, \Victor \mapsto
195 ] ~/ \{\Misha, \Petr\}$
\item Пусть Friend = $[\Misha \mapsto \Anna, \Anna \mapsto
\Lesha, \Lesha \mapsto \Misha]$. Найти Friend $\Superp$ Friend.
Какой смысл этого значения ?
\item $\Card \Dom [1 \mapsto 2, 1 \mapsto 3, 2 \mapsto 3]$
\item $\Dom ([10 \mapsto 100, 20 \mapsto 50] \Upd [20 \mapsto
60, 30 \mapsto 90])$
\item $\Card \Rng ( [1 \mapsto 2] \Superp [3 \mapsto 2, 4
\mapsto 1] \Superp [1 \mapsto 2, 3 \mapsto 4])$
\end{enumerate}

\subsection{Какие из следующих выражений верны} Если выражение
неверно, привести контпример и дополнительные ограничения на
входящие переменные, чтобы условие стало верным. Считать, что все
переменные стоят под кванторами всеобщности.
\begin{enumerate}
\item $\Dom (X \Union Y) \Iden \Dom X \Union \Dom Y$
\item $\Rng (X \Union Y) \Iden \Rng X \Union \Rng Y$
\item $\Dom (X \Upd Y) \Iden \Dom X \Upd \Dom Y$
\item $\Rng (X \Upd Y) \Iden \Rng X \Upd \Rng Y$
\item $X = Y \Impl \Dom X = \Dom Y$
\item $X \NEq Y \Impl \Dom X \NEq \Dom Y$
\item $X \NEq Y \Impl \Rng X \NEq \Rng Y$
\item $\Dom (X \backslash Y) \Iden (\Dom X~) \backslash Y$
\item $\Dom (X / Y) \Iden Y$
\item $\Dom (X \Upd Y) \Iden \Dom X \Union Y$
\item $(X \Union Y) \Union Z \Iden X \Union (Y \Union Z)$
\item $(X \Upd Y) \Upd Z \Iden X \Upd (Y \Upd Z)$
\item $(X \Superp Y) \Superp Z \Iden X \Superp (Y \Superp Z)$
\item $X \Union Y \Iden Y \Union X$
\end{enumerate}

\subsection{Записать на RSL следующие константы и определения
типов}
\begin{enumerate}
\item Записать отображение -- перестановку первых $N$ натуральных
чисел. Считать $N$ константой с sort-определением.
\item Записать отображение-<<сдвиг>> : [1 $\mapsto$ 2, 2 $\mapsto$
3, ..., $N \mapsto$ 1]. Считать $N$ константой с sort-определением.
\item Записать отображение всех полных квадратов в своё основание.
[1 $\mapsto$ 1, 4 $\mapsto$ 2, 9 $\mapsto$ 3, ...]
\item Записать отображение из любого натурального числа в его
простой делитель.
\item Записать отображение любого натурального числа в большее его простое
натуральное число. [1 $\mapsto$ 5, 2 $\mapsto$ 7, 3 $\mapsto$ 5,
...]
\item Записать отображение <<бесконечная перестановка>>.
\item Записать отображение любого натурального числа в своё
<<зеркало>> -- число из цифр исходного числа, записанных в обратном
порядке. [1 $\mapsto$ 1, ..., 12 $\mapsto$ 21, ..., 832 $\mapsto$
238, ...]
\item Записать отображение любого текста в его реверсию. $[...,
\mbox{\textrm{"стол"}} \mapsto \mbox{\textrm{"лотс"}},
\mbox{\textrm{"книга"}} \mapsto \mbox{\textrm{"агинк"}}, ...]$
\item Не меняя описания предыдущей константы, описать новое
отображение любого текста, начинающегося с 'a', в его реверсию.
\item Записать тип <<Англо-русский словарь>> так, как Вы его
представляете. Учтите, что слово может иметь несколько переводов.
\end{enumerate}

\subsection{Запишите спецификацию функций в явном (неявном) виде}
\begin{enumerate}
\item Подсчитать количество элементов в данном отображении, если оно
    \begin{enumerate}
    \item детерминированное
    \item ${^\star}$ недетерминированное
    \end{enumerate}
\item По отображению \{[$a \mapsto b$]\} построить отображение
\{[$a^2 \mapsto b^2$]\}.
\item Дано отображение \Nat $\Map$ \Nat. Вернуть количество элементов,
отображающих в 0.
\item По данному отображению \{[$a \mapsto b$]\} построить
отображение \{[$b \mapsto x$]\}, где $b$ - правая часть некоторого
элемента исходного отображения, а $x$ - количество раз, которое $b$
встретилось в исходном отображении.
\item Дано отображение \Nat $\Map$ \Nat. Вернуть количество различных
элементов, в которые осуществляется отображение.
\item Дано отображение \Nat $\Map$ \Real, представляющее основание и
показатель степени в разложении числа на простые множители. Вернуть
число, которое представлено таким отображением.
\item Дано натуральное число. Построить по нему отображение \Nat $\Map$ \Real,
представляющее основание и показатель степени в разложении его на
простые сомножители.
\item Дано отображение строк \{[$s \mapsto t$]\}. Оставить в нём только те
элементы, левая часть которого начинается с $s_0$.
\item Проверить, является ли данное отображение детерминированным.
\item Проверить, является ли данное отображение конечным.
\item Проверить, является ли данное отображение взаимнооднозначным.
\item Проверить, есть ли в данном отображении элемент $x \mapsto y$,
где $x$ -- наибольший из всех левых частей, а $y$ -- наименьший
среди всех правых частей.
\item Проверить, является ли данное отображение перестановкой.
\item Проверить, является ли данное отображение перестановкой первых $N$ натуральных чисел.
\item Дано отображение \{[$(x, y) \mapsto L$]\} ($L$ -- множество).
Проверить, верно ли, что все элементы в $L$ не больше $y$ и не
меньше $x$.
\item Дано отображение. Построить его максимальное детерминированное
подотображение.
\item Реляционное отношение задано отображением $T \Map A \DP B \DP
C$. Проверить, есть ли среди атрибутов $A$, $B$, $C$ возможные
ключи. Домены атрибутов считать sort-определенными.
\item Реализуйте функцию $lower$, переводящую символы в нижний
регистр. Какова, по Вашему, будет сигнатура этой функции?
\end{enumerate}

\subsection{Дайте спецификацию на RSL для следующих систем}
\begin{enumerate}
\item Склад товаров можно представить в виде отображения:
Имя\_товара $\mapsto$ Количество\_товара. Опишите тип <<Склад
товаров>> со следующими операциями (представленные операции получают
на вход склад и возвращают новый склад):
    \begin{enumerate}
    \item выдать все имеющиеся на складе товары
    \item взять товар (его некоторое количество) со склада
    \item добавить товар (его некоторое количество) на склад
    \item выдать все закончившиеся товары
    \item выдать оставшееся количество товара с данным именем
    \end{enumerate}

\item Склад товаров можно представить в виде отображения:
Имя\_товара $\mapsto$ Цена\_товара. Опишите тип <<Склад товаров>> со
следующими операциями (представленные операции получают на вход
склад и возвращают новый склад):
    \begin{enumerate}
    \item выдать все имеющиеся на складе товары
    \item установит на товар данную цену
    \item сбросить цены на все товары на данное количество процентов
    \item вычислить среднюю цену на товар
    \item выдать все дешёвые товары (цена которых меньше средней
    цены по складу)
    \end{enumerate}

\item Опишите модуль ШКОЛА: у каждого ученика данной школы есть
дневник, двух одинаковых учеников нет, дневник содержит оценки по
каждому предмету, предметы не повторяются. Описать в это модуле
следующий набор операций:
    \begin{enumerate}
    \item выдать всех учеников данной школы
    \item выдать все предметы данной школы
    \item выдать всех отличников данной школы (тех, кто учится на
    одни пятёрки)
    \item выдать процент учеников школы, не усваивающих материал
    (т.е. имеющих меньше трёх баллов за какой-либо предмет)
    \item выдать предмет, который усваивается хуже всех
    \item выдать предмет, который усваивается лучше всех
    \end{enumerate}

\item Описать модуль МАССИВ, содержащий описание типа <<Массив>> из
элементов одного типа. Размер массива $N$ (константа с
sort-определением). Модуль содержит следующие операции:
    \begin{enumerate}
    \item выдать длину данного массива
    \item выдать значение элемента данного массива по данному индексу
    \item вычислить максимальное значение среди элементов данного
    массива
    \item вычислить сумму элементов данного массива
    \item отсортировать элементы массива в порядке возрастания
    \item вернуть индекс первого вхождения в массив данного элемента
    $x$
    \item по данному массиву построить массив из тех же элементов,
    но в обратном порядке
    \item слить два данных упорядоченных по возрастанию массивов
    (создать новый массив из всех элементов данных двух массивов,
    также упорядоченный, методом слияния)
    \end{enumerate}

\item Описать модуль РАЗРЕЖЕННЫЙМАССИВ, содержащий описание типа
<<Разреженный массив>> из элементов одного типа. Размер массива $N$
(константа с sort-определением). Модуль содержит следующие операции:
    \begin{enumerate}
    \item выдать текущее количество элементов данного массива
    \item выдать значение элемента данного массива по данному индексу
    \item запомнить значение элемента данного массива по данному
    индексу
    \item вычислить максимальное значение среди элементов данного
    массива
    \item вычислить сумму элементов данного массива
    \item отсортировать элементы массива в порядке возрастания
    \item вернуть индекс первого вхождения в массив данного элемента
    $x$
    \end{enumerate}

\item Описать модуль ПОЛИНОМ, содержащий описание типа <<Полином>> в
виде отображения \{ [ индекс $\mapsto$ коэффициент ] \} (индексы с
нулевым коэффициентом не представлены) и спецификацию следующих
операций-задач\footnote{Большинство задач взято из книги А. Шеня
<<Программирование: теоремы и задачи>>}:
    \begin{enumerate}
    \item вернуть степень данного полинома
    \item вернуть значение максимального коэффициента данного полинома.
    \item вернуть значение данного полинома в данной точке $x$.
    \item вернуть значение производной данного полинома в данной точке $x$.
    \item вернуть сумму двух данных полиномов (это будет полином;
    степени данных полиномов могут быть разными)
    \item вернуть произведение двух данных полиномов (это будет полином;
    степени данных полиномов могут быть разными)
    \item вернуть НОД двух данных полиномов
    \end{enumerate}


\item Описать модуль МАТРИЦА, содержащий описание типа <<Матрица>>
(например, в виде отображения натуральных чисел в отображения
натуральных чисел в вещественные, не забыв ограничения на такое
задание) со следующими операциями:
    \begin{enumerate}
    \item выдать элемент с индексами $[i, j]$ ($i$ -- номер строки,
    $j$ -- номер столбца)
    \item выдать множество элементов матрицы
    \item линеаризовать множество в список (сначала первая строка,
    затем вторая, затем третья и т.д.)
    \item сложить две матрицы
    \item перемножить две матрицы
    \item транспонировать матрицу
    \end{enumerate}

\item Описать модуль LISTMAP, содержащий описание типа список на
основе типа отображение со следующими операциями
    \begin{enumerate}
    \item проверка на пустоту
    \item длина
    \item конкатенация двух данных списков
    \item получение головы списка
    \item получение хвоста списка
    \item получение множества элементов списка
    \end{enumerate}

\item Описать модуль SETMAP, содержащий описание типа множество на
основе типа отображение со следующими операциями:
    \begin{enumerate}
    \item проверка на пустоту
    \item количество элементов
    \item объединение множеств
    \item пересечение множеств
    \item вычитание множеств
    \item проверка того, что одно множество нестрого вложено в другое
    \item проверка того, что данный элемент входит в данное
    множество
    \end{enumerate}

\item Описать модуль MAPLIST, содержащий описание типа (детерминированное) отображение
на основе типа список со следующими операциями:
    \begin{enumerate}
    \item проверка на пустоту
    \item получение области определения
    \item получение области значений
    \item обновление данного отображения вторым данным отображением
    \end{enumerate}

\item Описать модуль MAPSET, содержащий описание типа (детерминированное) отображение
на основе типа множество со следующими операциями:
    \begin{enumerate}
    \item проверка на пустоту
    \item получение области определения
    \item получение области значений
    \item обновление данного отображения вторым данным отображением
    \end{enumerate}

\item Реализуйте на основе отображений модуль хэшированного хранения
данных (размер хэш-таблицы равен $N$, хэш-функция $f(x) =
x~\textrm{mod}~M$, $M$ -- простое число; при совпадении значения
хэш-функции элемент помещается в конец списка для данного значения
хэш-функции) со следующими операциями
    \begin{enumerate}
    \item очистка содержимого хранения
    \item добавление пары (ключ, значение)
    \item проверка вхождения данного ключа
    \item поиск значения по заданному ключу
    \end{enumerate}
\end{enumerate}

\subsection{База данных <<Журналы-Подписчики>>} Пусть база данных
издательства описана так, как показано ниже. Реализуйте функции по
сигнатуре и семантике, записанной в комментарии перед сигнатурой.

\begin{verbatim}
type
    Magazin,
    Subscriber,
    Mailboxes = Subscriber -m-> Magazin-set,
    PubHouse = Magazin-set >< Mailboxes
value
    /* выдать все журналы, печатаемые данным издательством */
    allMagazines : PubHouse -> Magazin-set,

    /* печатает ли данное издательство данный журнал */
    hasMagazin : PubHouse >< Magazin -> Bool,

    /* любой человек выписывает в данном издательстве
        не менее 1 и не более 5 журналов */
    success : PubHouse -> Bool,

    /* любой журнал в данном издательстве выписывается
        не менее 1м и не более 100 людьми */
    success2 : PubHouse -> Bool,

    /* выдать всех подписчиков данного журнала в данном изд-ве */
    allSubscribers : PubHouse >< Magazin -> Subscriber-set,

    /* выдать множество журналов, выписываемое данным
        человеком в данном издательстве */
    magsOf : Subscriber >< PubHouse -> Magazin-set,

    /* добавить журнал в данное издательство */
    addMagazin : PubHouse >< Magazin -> PubHouse,

    /* убрать журнал из данного издательства */
    dropMagazin : PubHouse >< Magazin -> PubHouse
\end{verbatim}

\subsection{$^{\star\star}$ Система поддержки метрополитена}
Дополните данное описание требованием о том, что станции на линии
уникальны, и опишите тела всех функций, сигнатуры и неформальная
семантика которых записаны ниже:

\begin{verbatim}
type
    СхемаМетро = НазваниеЛинии -m-> СтанцияНаСхеме-list,
    СтанцияНаСхеме = НазваниеСтанции >< Переход-set,
    Станция = НазваниеСтанции >< НазваниеЛинии,
    Переход = Станция,
    НазваниеСтанции = Text
/* По первому пути идут поезда в сторону увеличения индекса
        станции в списке, описывающем линию ;
    названия линий уникальны, названия станций могут повторяться,
    названия станций на одной линии уникальны */
value
    /* выдать множество всех линий метрополитена */
    всеЛинии : СхемаМетро -> НазваниеЛинии-set,

    /* выдать множество всех станций метрополитена */
    всеСтанции : СхемаМетро -> Станция-set,

    /* множество станций, до которых идут поезда с первого пути */
    Поезда1Путь : СхемаМетро >< Станция -> НазваниеСтанции-set,

    /* выдать текстовое сообщение при закрытии дверей на данной
        станции, если поезд находится на втором пути (название
        следующей станции при открытии дверей не объявляется);
        не забудьте о детях и инвалидах */
    ДвериЗакрываются : СхемаМетро >< Станция -> Text,

    /* выдать самый большой переход */
    СамыйБольшойПереход : СхемаМетро -> Станция-set,

    /* есть ли кольцевая линия? */
    ЕстьКольцо : СхемаМетро -> Bool,

    /* можно ли с кольца перейти на любую линию? */
    СКольцаНаЛюбую : СхемаМетро -> Bool,

    /* можно ли с любой линии перейти на любую линию? */
    СЛюбойНаЛюбую : СхемаМетро -> Bool,

    /* можно ли доехать от любой станции до любой
        другой, совершив не более двух пересадок? */
    НормальнаяСхема: СхемаМетро -> Bool,

    /* найти путь в виде списка станций между двумя
        данными станциями */
    Путь: СхемаМетро >< Станция >< Станция -~->
            Станция-list,

    /* найти путь в виде списка станций между двумя
        данными станциями минимальной длины*/
    МинимПуть: СхемаМетро >< Станция >< Станция -~->
            Станция-list,

    /* между какими двумя станциями среди всех путей
        в виде списка станций минимальной длины путь
        является максимальным ? */
    СамыеУдаленные: СхемаМетро -> Станция >< Станция
\end{verbatim}

\subsection{ER-диаграммы} Предложите наиболее общий способ описания
модели данных, представимой ER-диаграммой (1--1, 1--$\star$,
$\star$--$\star$).

На основе Вашего предложения напишите на RSL определения типов для
модели данных <<Выпускники>>, согласно диаграмме на приведенном рисунке:

\begin{figure}[h]
\centering
\includegraphics[width=0.88\textwidth]{05/er.eps}
\end{figure}

%\subsubsection{Уточните данную алгебраическую спецификацию до явной/неявной}

%\subsubsection{Докажите, что вторая схема является уточнением
%первой}

\subsection{Запишите спецификацию функции в явном виде по её
неявному заданию}
\begin{enumerate}
\item
\begin{verbatim}
type
    X, Y, M = X -m-> Y
value
    f : M >< M -> M
    f(x, y) as z
    post
        dom z = dom x union dom y
        /\
        (
            all a : X :-
                a isin dom z =>
                z(a) = (if a isin dom y then y else x end)(a)
        )
\end{verbatim}

\item
\begin{verbatim}
type
    X, Y, M = X -m-> Y
value
    f: M >< X-infset -> M
    f(x, y) as z
    post
        dom z = dom x inter y
        /\
        (
            all a : X :- a isin dom z => z(a) = x(a)
        )
\end{verbatim}

\item
\begin{verbatim}
type
    X, Y, M = X -m-> Y
value
    f: M >< X-infset >< X-infset -> M
    f(x, y, z) as t
    post
        dom t = dom x \ (y union z)
        /\
        (
            all a : X :- a isin dom t => z(a) = x(a)
        )
\end{verbatim}
\end{enumerate}
