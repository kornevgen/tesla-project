#summary Руководство по установке и использованию
#labels Featured

= Установка и использование =
  # скачать архив с исходниками на ruby
  # cкачать jar с генератором
  # скачать и установить Jruby http://www.jruby.org
  # скачать и установить инструмент Z3 http://research.microsoft.com/en-us/um/redmond/projects/z3/download.html
  # подготовить модель микропроцессора
  # подготовить набор тестовых шаблонов (или подготовить генератор тестовых шаблонов)
  # подготовить конструктор текстов тестовых программ
  # подготовить и исполнить процедуру, вызывающую генератор из jar

== Подготовить модель микропроцессора ==
Модель микропроцессора состоит из модели блоков MMU (например, TLB, отдельный уровень кэш-памяти и т.п.) и моделей инструкций. Модели инструкций задаются в виде XML-текста (см. [TestSituationsXMLDescription]). Модели блоков оформляются в виде класса, реализующего интерфейс `ru.teslaprj.Microprocessor`.

== Подготовить набор тестовых шаблонов ==
Тестовые шаблоны задаются в виде XML-текста (см. [TestTemplatesXMLDescription]).

== Подготовить конструктор текстов тестовых программ ==
Надо реализовать интерфейс `ru.teslaprj.TextConstructor`. Он состоит из всего одного метода, который по данному решению, шаблону и количеству иницализирующих обращений в блокм должен построить инициализирующую программу:
{{{
	ru.teslaprj.Program build_initialization(
			Map<ru.teslaprj.Parameter, BigInteger> solve,
			Map<ru.teslaprj.Table, Integer> initlengths,
			ru.teslaprj.Template template );
}}}
Инициализация состоит из последовательности инструкций, которые осуществляют:
  * инициализацию состояния микропроцессора, установкой нужных флагов и регистров состояния
  * инициализация регистров, установкой в них нужных значений
  * инициализация блоков MMU последовательностью инструкций обращения к памяти, которые обращаются именно к этим блокам

== Подготовить и исполнить процедуру, вызывающую генератор из jar ==
Типичная процедура вызова генератора имеет следующий вид (`microprocessor` -- модель микропроцессора, `template` -- тестовый шаблон, `ThisTextConstructor` -- класс-конструктор текстов):
{{{
  // ИНИЦИАЛИЗАЦИЯ ГЕНЕРАТОРА
    	ru.teslaprj.Generator smt_generator = new ru.teslaprj.Generator();

        smt_generator.setMicroprocessor( microprocessor );
    	smt_generator.setSolver( new ru.teslaprj.Solver() );
    	smt_generator.setTextConstructor( new ThisTextConstructor() );

        set_environment( smt_generator )

  // ЗАПУСК ГЕНЕРАТОРА    	   	
    	try
    	{
    		return smt_generator.generate( template, false );
    	}
    	catch(Exception e)
    	{
    		e.printStackTrace();
    	}
}}}

Обязательная последовательность действий по работе с генератором следующая:
  # инициализация
    * 

{{{
    	// for example, jruby.home = C:/Program Files/jruby-1.4.0
    	String jruby_home =  System.getProperty( "jruby.home" );
    	if ( jruby_home == null )
    		throw new IllegalStateException("Isn't defined environment variable JRUBY_HOME");    	
    	smt_generator.setJrubyHome( jruby_home );

    	// for example, jruby.lib = C:/Program Files/jruby-1.4.0/lib
    	String jruby_lib = System.getProperty("jruby.lib");
    	if ( jruby_lib == null )
    		throw new IllegalStateException("Isn't defined environment variable JRUBY_LIB");    	
    	smt_generator.setJrubyLib( jruby_lib );
    	
    	// for example, jruby.script = C:/Program Files/jruby-1.4.0/bin/jruby.bat
    	String jruby_script = System.getProperty("jruby.script");
    	if ( jruby_script == null )
    		throw new IllegalStateException("Isn't defined environment variable JRUBY_SCRIPT");    	
    	smt_generator.setJrubyScript( jruby_script );
    	
    	// for example, jruby.shell = cmd.exe
    	String jruby_shell = System.getProperty("jruby.shell");
    	if ( jruby_shell == null )
    		throw new IllegalStateException("Isn't defined environment variable JRUBY_SHELL");    	
    	smt_generator.setJrubyShell( jruby_shell );
    	
    	// for example, tesla.ruby = ./ruby
    	String tesla_ruby = System.getProperty("tesla.ruby");
    	if ( tesla_ruby == null )
    		throw new IllegalStateException("Isn't defined environment variable TESLA_RUBY");    	
    	smt_generator.setPathToRubySources( tesla_ruby );
    	
    	// for example, xmls.path = ./tesla
    	final String instructions_path = System.getProperty("xmls.path");
    	if ( instructions_path == null )
    		throw new IllegalStateException("Isn't defined environment variable XMLS_PATH");
}}}
  # запуск
 ...